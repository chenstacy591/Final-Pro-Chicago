---
title: "Chicago Domestic Crimes During Pandemic"
output: pdf_document
author: Samuel, Natalie, & Stacy
---

## INTRODUCTION AND DATA

Safer at home? Domestic Violence During the COVID-19 Pandemic

In what has been dubbed “a pandemic within a pandemic,” a new public health crisis has emerged in the wake of the coronavirus - increasing rates of domestic violence, affecting those in abusive relationships around the globe. This trend is not necessarily surprising, since rates of domestic violence tend to increase whenever families spend more time together - such as during Christmas and summer vacations - according to Bristol University sociologist Marianne Hester, but still troubling nonetheless, especially in countries (like the United States) where the virus doesn’t seem to be disappearing anytime soon. Without a strong support network due to social distancing and lockdown restrictions, it is much more difficult for victims of domestic violence to get help or escape (quarantined in their home), while the situation also enables the abuser by giving them greater power and control over what their partner can and can not do - suggesting that perhaps not everyone is truly “safer at home.” 

In order to further investigate the rate of domestic violence during COVID-19, we decided to pulled existing data from the City of Chicago Data Portal, which contains data related to reported incidents of crime (with the exception of murders where data exists for each victim) that occurred in the City of Chicago from 2001 to present. The data contained in this dataset were extracted from the Chicago Police Department's CLEAR (Citizen Law Enforcement Analysis and Reporting) system.


-introduce your general research question and your data (where it came from, how it was collected, what are the cases, what are the variables, etc.).
-Define what we mean by domestic violence

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message=F, warning=F)
domvio <- read.csv("data/chicago.csv")
library(tidyverse)
```

## METHODOLOGY
-variables used to address your research question
-useful visualizations or summary statistics
-introduce and justify the statistical method(s) that you believe will be useful in answering your research question.

```{r mutate original data to make month day year variables}
domvio<-domvio %>%
  mutate(MONTH = substring(DATE..OF.OCCURRENCE, 0, 2)) %>% 
  mutate(DAY = substring(DATE..OF.OCCURRENCE, 4,5)) %>% 
  mutate(YEAR = substring(DATE..OF.OCCURRENCE, 7,10)) %>%
  mutate(DATEINT = as.integer(paste(YEAR, MONTH, sep=""))) %>%
  mutate(MONTH = as.integer(substring(DATE..OF.OCCURRENCE, 0, 2))) %>% 
  mutate(DAY = as.integer(substring(DATE..OF.OCCURRENCE, 4,5))) %>% 
  mutate(YEAR = as.integer(substring(DATE..OF.OCCURRENCE, 7,10)))

#here's what the data looks like
glimpse(domvio)
```


```{r making mutated dataset for new indicators}
domvio_mut<-domvio
```

```{r beforecovid-indicator}
#create an indicator for being before covid entirely
#this indicator is "isbeforecovid" 2019/7/10-2020/1/24 
domvio_mut<-domvio_mut %>%
  mutate(isbeforecovid = case_when(
    YEAR == 2019 ~ 1,
    YEAR == 2020 & MONTH == 1 & DAY <=24 ~ 1,
    YEAR == 2020 & MONTH == 1 & DAY > 24 ~ 0,
    YEAR == 2020 & MONTH > 1 ~ 0,
    ))
```

```{r prelockdown-indicator}
#create an indicator for being before lockdown (tho covid is in the USA)
#this indicator is "isprelockdown" 2020/1/25-2020/3/21
domvio_mut<-domvio_mut %>%
  mutate(isprelockdown = case_when(
    YEAR == 2019 ~ 0,
    YEAR == 2020 & MONTH == 1 & DAY <=24 ~ 0,
    YEAR == 2020 & MONTH == 1 & DAY > 24 ~ 1,
    YEAR == 2020 & MONTH == 2  ~ 1, 
    YEAR == 2020 & MONTH == 3 & DAY < 22 ~ 1,
    YEAR == 2020 & MONTH == 3 & DAY >= 22 ~ 0,
    YEAR == 2020 & MONTH > 3 ~ 0
    ))
```

```{r lockdown-indicator}
#create an indicator for being in the lockdown
#this indicator is "islockdown" 2020/3/22-2020/4/30
domvio_mut<-domvio_mut %>%
  mutate(islockdown = case_when(
    YEAR == 2019 ~ 0,
    YEAR == 2020 & MONTH < 3 ~ 0, 
    YEAR == 2020 & MONTH == 3 & DAY < 22 ~ 0,
    YEAR == 2020 & MONTH == 3 & DAY >= 22 ~ 1,
    YEAR == 2020 & MONTH == 4 ~ 1,
    YEAR == 2020 & MONTH >= 5 ~ 0
    ))
```

```{r phase2-indicator}
#create an indicator for phase 2 in the recovery
#this indicator is "isphase2" 2020/5/1-2020/6/2
domvio_mut<-domvio_mut %>%
  mutate(isphase2 = case_when(
    YEAR == 2019 ~ 0,
    YEAR == 2020 & MONTH < 5 ~ 0, 
    YEAR == 2020 & MONTH == 5 ~ 1,
    YEAR == 2020 & MONTH == 6 & DAY < 3 ~ 1,
    YEAR == 2020 & MONTH == 6 & DAY >= 3 ~ 0,
    YEAR == 2020 & MONTH >= 7 ~ 0
    ))
```

```{r phase3-indicator}
#create an indicator for phase 3 in the recovery
#this indicator is "isphase3" 2020/6/3-2020/6/25
domvio_mut<-domvio_mut %>%
  mutate(isphase3 = case_when(
    YEAR == 2019 ~ 0,
    YEAR == 2020 & MONTH < 6 ~ 0, 
    YEAR == 2020 & MONTH == 6 & DAY < 3 ~ 0,
    YEAR == 2020 & MONTH == 6 & DAY >= 3 & DAY <= 25 ~ 1,
    YEAR == 2020 & MONTH == 6 & DAY > 25 ~ 0,
    YEAR == 2020 & MONTH >= 7 ~ 0
    ))
```

```{r phase4-indicator}
#create an indicator for phase 4 in the recovery
#this indicator is "isphase4" 2020/6/26-2020/7/8 (last day on dataset)
domvio_mut<-domvio_mut %>%
  mutate(isphase4 = case_when(
    YEAR == 2019 ~ 0,
    YEAR == 2020 & MONTH < 6 ~ 0, 
    YEAR == 2020 & MONTH == 6 & DAY < 26 ~ 0,
    YEAR == 2020 & MONTH == 6 & DAY >= 26 ~ 1,
    YEAR == 2020 & MONTH >= 7 ~ 1
    ))
```

```{r domvio-indicator}
#find which labels have to do with domestic violence
domvio_cat<-domvio_mut %>%
  group_by(SECONDARY.DESCRIPTION) %>%
  summarise(n=n())
domvio_cat

#create an indicator for cases of dom violence
#this indicator is "isdomviolence"
domvio_mut<-domvio_mut %>%
  mutate(isdomviolence = case_when(
    SECONDARY.DESCRIPTION == "VIOLATION OF BAIL BOND - DOMESTIC VIOLENCE" |
    SECONDARY.DESCRIPTION == "DOMESTIC BATTERY SIMPLE" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY: OTHER DANGEROUS WEAPON" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY: OTHER DANG WEAPON" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY: KNIFE/CUTTING INST" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY: KNIFE / CUTTING INSTSTRUMENT" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY: HANDS/FIST/FEET SERIOUS INJURY" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY: HANDGUN" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY - OTHER FIREARM" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY - OTHER DANGEROUS WEAPON" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY - KNIFE / CUTTING INSTRUMENT" |
    SECONDARY.DESCRIPTION == "AGGRAVATED DOMESTIC BATTERY - HANDGUN" |
    SECONDARY.DESCRIPTION == "AGG. DOMESTIC BATTERY - HANDS, FISTS, FEET, SERIOUS INJURY" ~ 1,
    SECONDARY.DESCRIPTION != "VIOLATION OF BAIL BOND - DOMESTIC VIOLENCE" &
    SECONDARY.DESCRIPTION != "DOMESTIC BATTERY SIMPLE" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY: OTHER DANGEROUS WEAPON" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY: OTHER DANG WEAPON" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY: KNIFE/CUTTING INST" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY: KNIFE / CUTTING INSTSTRUMENT" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY: HANDS/FIST/FEET SERIOUS INJURY" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY: HANDGUN" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY - OTHER FIREARM" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY - OTHER DANGEROUS WEAPON" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY - KNIFE / CUTTING INSTRUMENT" &
    SECONDARY.DESCRIPTION != "AGGRAVATED DOMESTIC BATTERY - HANDGUN" &
    SECONDARY.DESCRIPTION != "AGG. DOMESTIC BATTERY - HANDS, FISTS, FEET, SERIOUS INJURY" ~ 0
    ))
```

```{r cases-per-covidphase}
#if you are wondering about how the actual data looks like there it is

#number of observations during in 2020 pre covid=140697
domvio_mut %>% 
  count (isbeforecovid)

#number of observations during prelockdown=34619
domvio_mut %>% 
  count (isprelockdown)

#number of observations during lockdown=16842
domvio_mut %>% 
  count (islockdown)

#number of observations during p2=18578
domvio_mut %>% 
  count (isphase2)

#number of observations during p3=12722
domvio_mut %>% 
  count (isphase3)

#number of observations during p4=7544
domvio_mut %>% 
  count(isphase4)

#number of cases of domestic violence=24897
domvio_mut %>% 
  count(isdomviolence)
```

``` {r cases-per-day-or-month}
#see number of cases of domestic violence on a given day
domvio_mut %>% 
  filter(YEAR==2019) %>% 
  filter(MONTH==7) %>% 
  filter(DAY==9) %>% 
  count(isdomviolence)

#observations of domestic violence in a given month
domvio_mut %>% 
  filter(YEAR==2019) %>% 
  filter(MONTH==07) %>%
  count(isdomviolence)
```


```{r creating chisquare_indicators that shows before covid, during lockdown, and phase 3 together}
domvio_mut<-domvio_mut %>% 
  mutate(chisquare_indicators= case_when(isbeforecovid == 1 ~ "pre",
                                         isprelockdown == 1 ~ "pre",
                                         islockdown == 1 ~ "lockdown",
                                         isphase2 == 1 ~ "lockdown",
                                         isphase3 == 1 ~ "post",
                                         isphase4 == 1 ~ "post"
                                         ) )
```

## RESULTS
-Showcase how 
-Provide the main results from your analysis

```{r domestic-vs-time}
domvio_day<-as.data.frame(table(domvio_mut$DATEINT, domvio_mut$isdomviolence))

domvio_1<-domvio_day %>%
  filter (Var2 == 1) %>%
  pull()

domvio_day<-domvio_day %>%
  mutate (NONDOMVIO = Freq) %>%
  filter (Var2 == 0) %>%
  mutate (DOMVIOCASES = domvio_1) %>%
  select (-Var2, -Freq) %>%
  mutate (TOTCASES = DOMVIOCASES+NONDOMVIO) %>%
  mutate (PROPDOMVIO = DOMVIOCASES/TOTCASES)

ggplot(data = domvio_day, mapping = aes(x = Var1, y = PROPDOMVIO, group=1)) + geom_line()+ geom_point() +
labs(title = "Monthly domestic violence proportion seem to have shot up in March, when Chicago issued stay-at-home orders",
       x = "Year and Month (YYYYMM)",
       y = "Prop of reported crime that was domestic violence")


```

#### Chi-Square Test

```{r chisquared test}
table(domvio_mut$isdomviolence, domvio_mut$chisquare_indicators)
chisq.test(table(domvio_mut$isdomviolence, domvio_mut$chisquare_indicators))
```

Since the data (Table 1) satisfies the independent sampling assumption and is large enough (i.e. each cell > 10), we will be performing a chi-square test at the $\alpha$  = 0.05 significance level. We test the two hypotheses below: 

H~0 : The frequency of domestic violence cases in Chicago is unrelated to the phases of the pandemic.
H~1 : The frequency of domestic violence cases in Chicago is related to the phases of the pandemic.

Under the null hypothesis, our test statistic has a chi-square distribution with 2 degrees of freedom. We performed the test and obtained a chi-square value of 247.63, which corresponds to a p-value of < 0.001. Thus, at an $\alpha$ = 0.05 significance level, we reject the null hypothesis; there is sufficient evidence to suggest that the frequency of domestic violence cases in Chicago is related to the phases of the pandemic.

#### Step Down 2 Proportion Z-Tests

Since the overall Chi-square test was significant, we stepped down to identify where the differences are. We conducted three 2 proportion z-tests. To account for multiple comparisons, we will perform the Bonferroni correction and thus assess our results relative to the adjusted $\alpha$ = 0.05/3 level.

```{r 2-proportion-z-tests}
#lockdown-vs-post
prop.test(x=c(4311,2667),n=c(35420, 20266), alternative="two.sided", conf.level=.95)

#post-vs-pre
prop.test(x=c(2667, 17919),n=c(2667+17599, 17919+157397), alternative="two.sided", conf.level=.95)

#lockdown-vs-pre
prop.test(x=c(4311,17919),n=c(35420, 17919+157397), alternative="two.sided", conf.level=.95)

.05/3
```
We found that all three pairwise difference in proportions are significant at the adjusted significance level.

#### Regression Analysis

```{r logistic-var}
#Creating new dummy variables to use as indicators
library(broom)
domvio_mut <-domvio_mut %>% 
  mutate(pandemic_time = case_when(isbeforecovid == 1 ~ "before_covid",
                                         isprelockdown == 1 ~ "pre-lockdown",
                                         islockdown == 1 ~ "lockdown",
                                         isphase2 == 1 ~ "phase 2",
                                         isphase3 == 1 ~ "phase 3",
                                         isphase4 == 1 ~ "phase 4"
                                         ))

#Create logistic regression model with outcome as domestic violence case yes or no against timeframe relative to the pandemic and lockdown/reopening periods
domvio_mod <- glm(isdomviolence ~ pandemic_time, data = domvio_mut, 
                  family = "binomial")

#View model output
tidy(domvio_mod)

```
Our logistic regression model corresponding to the probability of success that a reported crime for a given time period will be one of domestic violence is as follows: 

$\hat{\beta}_0$ + $\hat{\beta}_1$(pandemic_time == lockdown) + $\hat{\beta}_2$(pandemic_time == phase 2) + $\hat{\beta}_3$(pandemic_time == phase 3) + $\hat{\beta}_4$(pandemic_time == phase 4) + $\hat{\beta}_5$(pandemic_time == pre-lockdown) 

At the $\alpha$ = 0.05 significance level, the true $\beta$ coefficients corresponding to the logit of the probability that a case reported during that time period was related to domestic violence for each of our dummy variables (all relative to the baseline/reference category of before the COVID-19 pandemic) were statistically significant. We were specifically interested in $\beta_1$, which corresponds to the logit of the probability of success (that a reported case was related to domestic violence) during lockdown, as compared to before the pandeimc began, and whether there was a relationship between the probability of a reported crime being related to domestic violence during lockdown, when compared to before the pandemic. 

H~0~: $\beta_1$ = 0 (There is no relationship between our predictor and the probability of success that a reported case is related to domestic violence, while holding all other variables constant. The true population parameter $\beta_1$ is equal to 0).  

H~1~: (There is a relationship between our predictor and the probability of success that a reported case is related to domestic violence, while holding all other variables constant. The true population parameter $\beta_1$ is not equal to 0).

Under the null hypothesis, our test statistic follows a standard normal distribution. The value of our test statistic is equal to approximately 12.426, which corresponds to a p-value of less than 0.001. Thus, at the $\alpha$ = 0.05, we reject our null hypothesis; we have sufficient evidence to suggest that the true value of $\beta_1$ is not equal to 0, such that this predictor tells us soemthing about the probability of success of our outcome, while holding all other variables constant.  

We see from the model output above that the estimated $\hat{\beta}_1$ coefficent, corresponding to the effect of being in the "lockdown" phase of time in quarantine - relative to the time period before COVID-19 - on the probability of success that a reported case will be related to domestic violence, is approximately 0.303. This corresponds to an odds ratio of exp(0.303), which is approximately 1.354. Therefore, we would expect crimes reported during the lockdown phase of the stay-at-home order in the city of Chicago to have 1.354 times the odds of being related to domestic violence, relative to cases that were reported before the COVID-19 pandemic began, while holding all other variables constant. 


```{r regression analysis pt 2}
augment(domvio_mod) %>%
  select(isdomviolence, pandemic_time, .fitted) %>% 
  mutate(pred_prob = exp(.fitted)/(1 + exp(.fitted)))

```


## DISCUSSION
-summary of what you have learned about your research question along
-statistical arguments supporting your conclusions
-critique your own methods and provide suggestions for improving your analysis (Issues pertaining to the reliability and validity of your data and appropriateness of the statistical analysis)
Make sure to mention possible confounders we did not include in our model, perhaps also the fact that we were just looking at Chicago, vs. the US as a whole or even multiple countires.
-what you would do differently
-what you would do next if you were going to continue work on the project
Are rates of domestic violence during lockdown different in different parts of the world and/or US?